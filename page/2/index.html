<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0">






<meta property="og:type" content="website">
<meta property="og:title" content="PREPARES">
<meta property="og:url" content="https://wangleileichina.github.io/page/2/index.html">
<meta property="og:site_name" content="PREPARES">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PREPARES">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://wangleileichina.github.io/page/2/">





  <title> PREPARES </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PREPARES</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wangleileichina.github.io/p/quick-sort.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeileiWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PREPARES">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/p/quick-sort.html" itemprop="url">
                  quick sort
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-06-23T01:15:07+08:00">
                2021-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        self.nums = nums</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, lo, hi)</span>:</span></span><br><span class="line">        pivot = self.nums[hi]</span><br><span class="line">        i = lo</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(lo, hi):</span><br><span class="line">            <span class="keyword">if</span> self.nums[j] &lt; pivot:</span><br><span class="line">                <span class="comment"># i停留在大于pivot的数， 等到j找到下一个小于pivot的数交换</span></span><br><span class="line">                self.nums[i], self.nums[j] = self.nums[j], self.nums[i]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        self.nums[i], self.nums[hi] = self.nums[hi], self.nums[i]</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(self, lo, hi)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> lo &gt;= hi:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        idx = self.partition(lo, hi)</span><br><span class="line">        self.sort(lo, idx - <span class="number">1</span>)</span><br><span class="line">        self.sort(idx + <span class="number">1</span>, hi)</span><br><span class="line"></span><br><span class="line">nums=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">7</span>]</span><br><span class="line">quicksort = QuickSort(nums)</span><br><span class="line">quicksort.sort(<span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br><span class="line">print(quicksort.nums)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(nums)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(lo, hi)</span>:</span></span><br><span class="line">        pivot = nums[hi]</span><br><span class="line">        i = lo</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(lo, hi):</span><br><span class="line">            <span class="keyword">if</span> nums[j] &lt; pivot:</span><br><span class="line">                <span class="comment"># i停留在大于pivot的数， 等到j找到下一个小于pivot的数交换</span></span><br><span class="line">                nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        nums[i], nums[hi] = nums[hi], nums[i]</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(lo, hi)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> lo &gt;= hi:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        idx = partition(lo, hi)</span><br><span class="line">        sort(lo, idx - <span class="number">1</span>)</span><br><span class="line">        sort(idx + <span class="number">1</span>, hi)</span><br><span class="line"></span><br><span class="line">    sort(<span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">nums=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">7</span>]</span><br><span class="line">quick_sort(nums)</span><br><span class="line">print(nums)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wangleileichina.github.io/p/Consistent-Hashing.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeileiWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PREPARES">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/p/Consistent-Hashing.html" itemprop="url">
                  Consistent Hashing
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-06-20T00:42:20+08:00">
                2021-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><code>Distributed Hash Table</code> (DHT) is one of the fundamental components used in distributed scalable systems. Hash Tables need a key, a value, and a hash function where hash function maps the key to a location where the value is stored:</p>
<blockquote>
<p>index = hash_function(key)</p>
</blockquote>
<p>Suppose we are designing a distributed caching system. Given “n” cache servers, an intuitive hash function would be “key % n”. It is simple and commonly used. But it has two major drawbacks:</p>
<ol>
<li>It is NOT horizontally scalable. Whenever a new cache host is added to the system, all existing mappings are broken. It will be a pain point in maintenance if the caching system contains lots of data. Practically, it becomes difficult to schedule a downtime to update all caching mappings;</li>
<li>It may NOT be load balanced, especially for non-uniformly distributed data. In practice, it can be easily assumed that the data will not be distributed uniformly. For the caching system, it translates into some caches becoming hot and saturated while the others idle and are almost empty;</li>
</ol>
<p>In such situations, consistent hashing is a good way to improve the caching system.</p>
<h2 id="What-is-Consistent-Hashing"><a href="#What-is-Consistent-Hashing" class="headerlink" title="What is Consistent Hashing?"></a>What is Consistent Hashing?</h2><p>Consistent hashing is a very useful strategy for distributed caching systems and DHTs. It allows us to distribute data across a cluster in such a way that will minimize reorganization when nodes are added or removed. Hence, the caching system will be easier to scale up or scale down.</p>
<p>In Consistent Hashing, when the hash table is resized (e.g., a new cache host is added to the system), only “k/n” keys need to be remapped where “k” is the total number of keys and “n” is the total number of servers. Recall that in a caching system using the “mod” as the hash function, all keys need to be remapped.</p>
<p>In Consistent Hashing, objects are mapped to the same host if possible. When a host is removed from the system, the objects on that host are shared by other hosts; when a new host is added, it takes its share from a few hosts without touching other’s shares.</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/p/Consistent-Hashing.html#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wangleileichina.github.io/p/segment-tree.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeileiWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PREPARES">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/p/segment-tree.html" itemprop="url">
                  segment tree
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-06-20T00:03:24+08:00">
                2021-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>线段树是一种非常灵活的数据结构，它可以用于解决多种范围查询问题，比如在对数时间内从数组中找到最小值、最大值、总和、最大公约数、最小公倍数等。<br>线段树既可以用数组也可以用树来实现。对于数组实现，如果索引 i 处的元素不是一个叶节点，那么其左子节点和右子节点分别存储在索引为 2i 和 2i+1 的元素处。<br>我们从叶节点开始，用输入数组的元素 a[0,1,…,n−1] 初始化它们。然后我们逐步向上移动到更高一层来计算父节点的和，直到最后到达线段树的根节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">class NumArray:</span><br><span class="line">    def __init__(self, nums):</span><br><span class="line">        n = len(nums)</span><br><span class="line">        self.tree = [0] * 2 * n</span><br><span class="line">        i, j = n, 0</span><br><span class="line">        while i &lt; 2 * n:</span><br><span class="line">            self.tree[i] = nums[j]</span><br><span class="line">            i += 1</span><br><span class="line">            j += 1</span><br><span class="line">        for i in range(n - 1, 0, -1): # 2n - 1个节点 所以 i 只用取到1</span><br><span class="line">            self.tree[i] = self.tree[i * 2] + self.tree[i * 2 + 1]</span><br><span class="line"></span><br><span class="line">    def  update(self, i, val):</span><br><span class="line">        n = len(self.tree) // 2</span><br><span class="line">        i += n</span><br><span class="line">        self.tree[i] = val</span><br><span class="line">        while i &gt; 0:</span><br><span class="line">            left, right = i, i</span><br><span class="line">            if i &amp; 1:</span><br><span class="line">                left = i - 1 # i 为偶数就是左节点</span><br><span class="line">            else:</span><br><span class="line">                right = i + 1</span><br><span class="line">            self.tree[i // 2] = self.tree[left] + self.tree[right]</span><br><span class="line">            i //= 2</span><br><span class="line"></span><br><span class="line">    def  sumRange(self, i, j):</span><br><span class="line">        n = len(self.tree) // 2</span><br><span class="line">        i += n</span><br><span class="line">        j += n</span><br><span class="line">        res = 0</span><br><span class="line">        while i &lt;= j:</span><br><span class="line">            if i &amp; 1:</span><br><span class="line">                res += self.tree[i] # 奇数右节点直接加</span><br><span class="line">                i += 1</span><br><span class="line">            if not (j &amp; 1):</span><br><span class="line">                res += self.tree[j]</span><br><span class="line">                j -= 1</span><br><span class="line">            i //= 2</span><br><span class="line">            j //= 2</span><br><span class="line">        return res</span><br><span class="line"></span><br><span class="line">nums = [1, 3, 5, 7, 9]</span><br><span class="line">rangeSum = NumArray(nums)</span><br><span class="line">print(rangeSum.sumRange(2, 3))</span><br><span class="line">rangeSum.update(1, 6)</span><br><span class="line">print(rangeSum.sumRange(1, 3))</span><br></pre></td></tr></table></figure>

<p>因为我们在 for 循环的每次迭代中计算一个节点的和。而一个线段树中大约有 2n 个节点。<br>这可以通过以下方式证明：具有 n 个元素的数组线段树有<br>n 个叶节点（数组元素本身）。每一层中的节点数是下面一层中节点数的一半。<br>因此，如果我们按层对节点数求和，我们将得到：n+n/2+n/4+n/8+…+1≈2n</p>
<p>空间复杂度：O(n)，我们用了 2n 的额外空间来存储整个线段树。</p>
<h2 id="LeetCode"><a href="#LeetCode" class="headerlink" title="LeetCode"></a>LeetCode</h2><p><a href="https://leetcode-cn.com/problems/range-sum-query-mutable/" target="_blank" rel="noopener">307. Range Sum Query - Mutable</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wangleileichina.github.io/p/A-Step-by-Step-Guide.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeileiWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PREPARES">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/p/A-Step-by-Step-Guide.html" itemprop="url">
                  A Step by Step Guide
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-06-19T17:44:35+08:00">
                2021-06-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>A lot of software engineers struggle with System Design Interviews (SDIs) primarily because of three reasons:</p>
<ol>
<li>The unstructured nature of SDIs, where the candidates are asked to work on an open-ended design problem that doesn’t have a standard answer;</li>
<li>Candidates lack experience in developing complex and large scale systems;</li>
<li>Candidates did not spend enough time to prepare for SDIs;</li>
</ol>
<p>Like coding interviews, candidates who haven’t put a deliberate effort to prepare for SDIs, mostly perform poorly, especially at top companies like Google, Facebook, Amazon, Microsoft, etc. In these companies, candidates who do not perform above average have a limited chance to get an offer. On the other hand, a good performance always results in a better offer (higher position and salary) since it shows the candidate’s ability to handle a complex system.</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/p/A-Step-by-Step-Guide.html#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://wangleileichina.github.io/p/pytest-Quick-Start-Guide.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LeileiWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PREPARES">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/p/pytest-Quick-Start-Guide.html" itemprop="url">
                  pytest Quick Start Guide
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-06-15T16:05:22+08:00">
                2021-06-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Writing-and-Running-Tests"><a href="#Writing-and-Running-Tests" class="headerlink" title="Writing and Running Tests"></a>Writing and Running Tests</h1><ul>
<li>Organizing files and packages</li>
<li>Useful command-line options</li>
<li>Configuration: pytest.ini file</li>
</ul>
<h2 id="Installing-pytest"><a href="#Installing-pytest" class="headerlink" title="Installing pytest"></a>Installing pytest</h2><h3 id="pip-and-virtualenv"><a href="#pip-and-virtualenv" class="headerlink" title="pip and virtualenv"></a>pip and virtualenv</h3><p><a href="https://packaging.python.org/guides/installing-using-pip-and-virtualenv/" target="_blank" rel="noopener">guides/installing-using-pip-and-virtualenv/</a><br><code>python -m venv .env</code><br><code>source .env/bin/activate</code><br><code>pip install pytest</code><br><code>pytest --version</code></p>
<h3 id="Writing-and-running-tests"><a href="#Writing-and-running-tests" class="headerlink" title="Writing and running tests"></a>Writing and running tests</h3><p>Note that there’s no need to create classes; just simple functions and plain assert statements are enough, but if you want to use classes to group tests you can do so:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMechanics</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_player_hit</span><span class="params">(self)</span>:</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_player_health_flask</span><span class="params">(self)</span>:</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>Grouping tests can be useful when you want to put a number of tests under the same scope: you can execute tests based on the class they are in, apply markers to all of the tests in a class (Chapter 3, Markers and Parametrization), and create fixtures bound to a class (Chapter 4, Fixtures).</p>
<h3 id="Running-tests"><a href="#Running-tests" class="headerlink" title="Running tests"></a>Running tests</h3><p><code>&gt; pytest</code><br>This will find all of the test_*.py and *_test.py modules in the current directory and below recursively, and will run all of the tests found in those files.You can reduce the search to specific directories<br><code>&gt; pytest  tests/core  tests/contrib</code><br>You can also mix any number of files and directories:<br><code>&gt; pytest  tests/core  tests/contrib/test_text_plugin.py</code><br>You can execute specific tests by using the syntax <code>test-file</code>::<code>test-function-name</code>:<br><code>&gt; pytest  tests/core/test_core.py::test_regex_matching</code><br>You can execute all of the test methods of a test class:<br><code>&gt; pytest  tests/contrib/test_text_plugin.py::TestPluginHooks</code><br>You can execute a specific test method of a test class using the syntax <code>test-file</code>::<code>test-class</code>::<code>test-method-name</code>:<br><code>&gt; pytest  tests/contrib/test_text_plugin.py::TestPluginHooks::test_registration</code><br>show a more verbose output, -v<br><code>&gt; pytest tests/core -v</code><br>To see which tests there are without running them, use the –collect-only  flag:<br>–collect-only is especially useful if you want to execute a specific test but can’t remember its exact name.<br><code>&gt; pytest tests/core --collect-only</code></p>
<h3 id="Powerful-asserts"><a href="#Powerful-asserts" class="headerlink" title="Powerful asserts"></a>Powerful asserts</h3><p>Contrary to other frameworks, you don’t need to remember various self.assert* or self.expect* functions.<br>here’s an example of a failure:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">________________________ test_default_health ________________________</span><br><span class="line"></span><br><span class="line">    def test_default_health():</span><br><span class="line">       <span class="built_in"> health </span>= get_default_health(<span class="string">'warrior'</span>)</span><br><span class="line">&gt;       assert<span class="built_in"> health </span>== 95</span><br><span class="line">E       assert 80 == 95</span><br><span class="line"></span><br><span class="line">tests\test_assert_demo.py:25: AssertionError</span><br></pre></td></tr></table></figure>

<h4 id="Text-differences"><a href="#Text-differences" class="headerlink" title="Text differences"></a>Text differences</h4><p>When showing the explanation for short strings, pytest uses a simple difference method:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">E         - warrior</span><br><span class="line">E         + sorcerer</span><br><span class="line"><span class="symbol">Longer</span> <span class="keyword">strings </span>show a smarter delta, using difflib.ndiff to quickly spot the differences</span><br><span class="line">E       AssertionError: <span class="meta">assert</span> <span class="string">'A battle-har... and weapons.'</span> == <span class="string">'A battle-hard... and weapons.'</span></span><br><span class="line">E         - A <span class="keyword">battle-hardened </span>veteran, favors heavy armor <span class="keyword">and </span>weapons.</span><br><span class="line">E         ?                            ^ ^^^^</span><br><span class="line">E         + A <span class="keyword">battle-hardened </span>veteran, can equip heavy armor <span class="keyword">and </span>weapons.</span><br><span class="line">E         ?                            ^ ^^^^^^^</span><br><span class="line"><span class="keyword">Multiline </span><span class="keyword">strings </span>are also treated specially:</span><br><span class="line">E       AssertionError: <span class="meta">assert</span> <span class="string">'A seasoned v... \n'</span> == <span class="string">'A seasoned ve... \n'</span></span><br><span class="line">E         - A seasoned veteran of many <span class="keyword">battles. </span>High <span class="keyword">Strength </span><span class="keyword">and </span>Dexterity</span><br><span class="line">E         ?                                     -----</span><br><span class="line">E         + A seasoned veteran of many <span class="keyword">battles. </span><span class="keyword">Strength </span><span class="keyword">and </span>Dexterity</span><br><span class="line">E           allow to <span class="keyword">yield </span>heavy armor <span class="keyword">and </span>weapons, as well as carry</span><br><span class="line">E         - more equipment <span class="meta">while</span> keeping a light roll. Weak in magic.</span><br><span class="line">E         ?               ---------------------------</span><br><span class="line">E         + more equipment. Weak in magic.</span><br></pre></td></tr></table></figure>

<h4 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h4><p>Assertion failures for lists also show only differing items by default:</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">E</span>       <span class="type">AssertionError</span>: assert [<span class="symbol">'long</span> sword'...et', <span class="symbol">'shield'</span>] == [<span class="symbol">'long</span> sword', <span class="symbol">'shield'</span>]</span><br><span class="line"><span class="type">E</span>         <span class="type">At</span> index <span class="number">1</span> diff: <span class="symbol">'warrior</span> set' != <span class="symbol">'shield'</span></span><br><span class="line"><span class="type">E</span>         <span class="type">Left</span> contains more items, first extra item: <span class="symbol">'shield'</span></span><br><span class="line"><span class="type">E</span>         <span class="type">Use</span> -v to get the full diff</span><br></pre></td></tr></table></figure>

<p>Note that pytest shows which index differs, and also that the -v flag can be used to show the complete difference between the lists:</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">E</span>       <span class="type">AssertionError</span>: assert [<span class="symbol">'long</span> sword'...et', <span class="symbol">'shield'</span>] == [<span class="symbol">'long</span> sword', <span class="symbol">'shield'</span>]</span><br><span class="line"><span class="type">E</span>         <span class="type">At</span> index <span class="number">1</span> diff: <span class="symbol">'warrior</span> set' != <span class="symbol">'shield'</span></span><br><span class="line"><span class="type">E</span>         <span class="type">Left</span> contains more items, first extra item: <span class="symbol">'shield'</span></span><br><span class="line"><span class="type">E</span>         <span class="type">Full</span> diff:</span><br><span class="line"><span class="type">E</span>         - [<span class="symbol">'long</span> sword', <span class="symbol">'warrior</span> set', <span class="symbol">'shield'</span>]</span><br><span class="line"><span class="type">E</span>         ?               ---------------</span><br><span class="line"><span class="type">E</span>         + [<span class="symbol">'long</span> sword', <span class="symbol">'shield'</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Dictionaries-and-sets"><a href="#Dictionaries-and-sets" class="headerlink" title="Dictionaries and sets"></a>Dictionaries and sets</h4><p>Dictionaries are probably one of the most used data structures in Python, so, unsurprisingly, pytest has specialized representation for them:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">E       AssertionError: assert &#123;<span class="string">'knight'</span>: <span class="number">95</span>...<span class="string">'warrior'</span>: <span class="number">85</span>&#125; == &#123;<span class="string">'sorcerer'</span>: <span class="number">50</span>, <span class="string">'warrior'</span>: <span class="number">85</span>&#125;</span><br><span class="line">E         Omitting <span class="number">1</span> identical <span class="built_in">items</span>, use -vv <span class="keyword">to</span> show</span><br><span class="line">E         Differing item<span class="variable">s:</span></span><br><span class="line">E         &#123;<span class="string">'sorcerer'</span>: <span class="number">55</span>&#125; != &#123;<span class="string">'sorcerer'</span>: <span class="number">50</span>&#125;</span><br><span class="line">E         Left contains more item<span class="variable">s:</span></span><br><span class="line">E         &#123;<span class="string">'knight'</span>: <span class="number">95</span>&#125;</span><br><span class="line">E         Use -v <span class="keyword">to</span> <span class="built_in">get</span> the full diff</span><br><span class="line"></span><br><span class="line">E         Extra <span class="built_in">items</span> in the <span class="keyword">left</span> <span class="keyword">se</span><span class="variable">t:</span></span><br><span class="line">E         <span class="string">'knight'</span></span><br></pre></td></tr></table></figure>

<h4 id="How-does-pytest-do-it"><a href="#How-does-pytest-do-it" class="headerlink" title="How does pytest do it?"></a>How does pytest do it?</h4><p>By default, Python’s assert statement does not provide any details when it fails, but as we just saw, pytest shows a lot of information about the variables and expressions involved in a failed assertion. So how does pytest do it?</p>
<p>Pytest is able to provide useful exceptions because it implements a mechanism called assertion rewriting.<br>ssertion rewriting works by installing a custom import hook that intercepts the standard Python import mechanism. When pytest detects that a test file (or plugin) is about to be imported, instead of loading the module, it first compiles the source code into an abstract syntax tree (AST) using the built-in ast module. Then, it searches for any assert statements and rewrites them so that the variables used in the expression are kept so that they can be used to show more helpful messages if the assertion fails. Finally, it saves the rewritten pyc file to disk for caching</p>
<h3 id="Checking-exceptions-pytest-raises"><a href="#Checking-exceptions-pytest-raises" class="headerlink" title="Checking exceptions: pytest.raises"></a>Checking exceptions: pytest.raises</h3><p>Testing that exceptions are raised in the appropriate circumstances is just as important as testing the main functionality of APIs. It is also important to make sure that exceptions contain an appropriate and clear message to help users understand the issue.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_character</span><span class="params">(name: str, class_name: str)</span> -&gt; Character:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Creates a new character and inserts it into the database.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :raise InvalidCharacterNameError:</span></span><br><span class="line"><span class="string">        if the character name is empty.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :raise InvalidClassNameError:</span></span><br><span class="line"><span class="string">        if the class name is invalid.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: the newly created Character.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_empty_name</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(InvalidCharacterNameError):</span><br><span class="line">        create_character(name=<span class="string">''</span>, class_name=<span class="string">'warrior'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_invalid_class_name</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(InvalidClassNameError):</span><br><span class="line">        create_character(name=<span class="string">'Solaire'</span>, class_name=<span class="string">'mage'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Checking-exception-messages"><a href="#Checking-exception-messages" class="headerlink" title="Checking exception messages"></a>Checking exception messages</h4><p>In the previous examples, we only verified that the code was raising the appropriate exception type, but not the actual message.<br>pytest.raises can receive an optional match argument, which is a regular expression string that will be matched against the exception message, as well as checking the exception type. For more details, go to: <a href="https://docs.python.org/3/howto/regex.html" target="_blank" rel="noopener">https://docs.python.org/3/howto/regex.html</a>. We can use that to improve our tests even further:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_empty_name</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(InvalidCharacterNameError,</span><br><span class="line">                       match=<span class="string">'character name empty'</span>):</span><br><span class="line">        create_character(name=<span class="string">''</span>, class_name=<span class="string">'warrior'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_invalid_class_name</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(InvalidClassNameError,</span><br><span class="line">                       match=<span class="string">'invalid class name: "mage"'</span>):</span><br><span class="line">        create_character(name=<span class="string">'Solaire'</span>, class_name=<span class="string">'mage'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Checking-warnings-pytest-warns"><a href="#Checking-warnings-pytest-warns" class="headerlink" title="Checking warnings: pytest.warns"></a>Checking warnings: pytest.warns</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_initial_hit_points</span><span class="params">(player_class: Union[PlayerClass, str])</span> -&gt; int:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(player_class, str):</span><br><span class="line">        msg = <span class="string">'Using player_class as str has been deprecated'</span> \</span><br><span class="line">              <span class="string">'and will be removed in the future'</span></span><br><span class="line">        warnings.warn(DeprecationWarning(msg))</span><br><span class="line">        player_class = get_player_enum_from_string(player_class)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_get_initial_hit_points_warning</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.warns(DeprecationWarning):</span><br><span class="line">        get_initial_hit_points(<span class="string">'warrior'</span>)</span><br></pre></td></tr></table></figure>

<p>As with pytest.raises, pytest.warns can receive an optional match argument, which is a regular expression string. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_get_initial_hit_points_warning</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> pytest.warns(DeprecationWarning,</span><br><span class="line">                      match=<span class="string">'.*str has been deprecated.*'</span>):</span><br><span class="line">        get_initial_hit_points(<span class="string">'warrior'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Comparing-floating-point-numbers-pytest-approx"><a href="#Comparing-floating-point-numbers-pytest-approx" class="headerlink" title="Comparing floating point numbers: pytest.approx"></a>Comparing floating point numbers: pytest.approx</h3><p>Numbers that we consider equal in the real world are not so when represented by computer hardware:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> <span class="string">+</span> <span class="number">0.2</span> <span class="string">==</span> <span class="number">0.3</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>When writing tests, it is very common to compare the results produced by our code against what we expect as floating point values. As shown above, a simple == comparison often won’t be sufficient. A common approach is to use a known tolerance instead and use abs to correctly deal with negative numbers:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_simple_math</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> abs(<span class="number">0.1</span> + <span class="number">0.2</span>) - <span class="number">0.3</span> &lt; <span class="number">0.0001</span></span><br></pre></td></tr></table></figure>

<p>But besides being ugly and hard to understand, it is sometimes difficult to come up with a tolerance that works in most situations. The chosen tolerance of 0.0001 might work for the numbers above, but not for very large numbers or very small ones.</p>
<p>pytest.approx solves this problem by automatically choosing a tolerance appropriate for the values involved in the expression, providing a very nice syntax to boot:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_approx_simple</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0.1</span> + <span class="number">0.2</span> == approx(<span class="number">0.3</span>)</span><br></pre></td></tr></table></figure>

<p>You can read the above as assert that 0.1 + 0.2 equals approximately to 0.3.<br>But the  approx function does not stop there; it can be used to compare:<br>Sequences of numbers:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_approx_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> [<span class="number">0.1</span> + <span class="number">1.2</span>, <span class="number">0.2</span> + <span class="number">0.8</span>] == approx([<span class="number">1.3</span>, <span class="number">1.0</span>])</span><br></pre></td></tr></table></figure>

<p>Dictionary values (not keys):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_approx_dict</span><span class="params">()</span>:</span></span><br><span class="line">    values = &#123;<span class="string">'v1'</span>: <span class="number">0.1</span> + <span class="number">1.2</span>, <span class="string">'v2'</span>: <span class="number">0.2</span> + <span class="number">0.8</span>&#125;</span><br><span class="line">    <span class="keyword">assert</span> values == approx(dict(v1=<span class="number">1.3</span>, v2=<span class="number">1.0</span>))</span><br></pre></td></tr></table></figure>

<p>numpy arrays:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_approx_numpy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">    values = np.array([<span class="number">0.1</span>, <span class="number">0.2</span>]) + np.array([<span class="number">1.2</span>, <span class="number">0.8</span>])</span><br><span class="line">    <span class="keyword">assert</span> values == approx(np.array([<span class="number">1.3</span>, <span class="number">1.0</span>]))</span><br></pre></td></tr></table></figure>

<p>When a test fails, approx provides a nice error message displaying the values that failed and the tolerance used:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="string">def</span> <span class="string">test_approx_simple_fail():</span></span><br><span class="line"><span class="string">&gt;</span>       <span class="string">assert</span> <span class="number">0.1</span> <span class="string">+</span> <span class="number">0.2</span> <span class="string">==</span> <span class="string">approx(0.35)</span></span><br><span class="line"><span class="string">E</span>       <span class="string">assert</span> <span class="string">(0.1</span> <span class="string">+</span> <span class="number">0.2</span><span class="string">)</span> <span class="string">==</span> <span class="number">0.35</span> <span class="string">±</span> <span class="number">3.5e-07</span></span><br><span class="line"><span class="string">E</span>        <span class="string">+</span> <span class="string">where</span> <span class="number">0.35</span> <span class="string">±</span> <span class="number">3.5e-07</span> <span class="string">=</span> <span class="string">approx(0.35)</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="LeileiWang">
          <p class="site-author-name" itemprop="name">LeileiWang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wangleileichina" target="_blank" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href target="_blank" title="LinkedIn">
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LeileiWang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


  

  

  

  


  

</body>
</html>
